<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Threat Hunting Assistant</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="container nav-container">
      <a href="#" class="logo">üõ°Ô∏è AI Threat Hunter</a>
      <div class="nav-links">
        <a href="#features">Features</a>
        <a href="#benefits">Benefits</a>
        <a href="#demo">Demo</a>
        <a href="#contact">Contact</a>
      </div>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search MITRE ATT&CK..." />
        <button onclick="searchTechniques()">Search</button>
      </div>
    </div>
  </nav>

  <!-- MITRE Search Section -->
  <section class="section section-light" id="mitreSearch">
    <div class="container">
      <a href="game.html" class="try-game">Try a Game</a>
      <a href="graph.html" class="nav-link">Top 10 MITRE ATT&CKs</a>
      <div id="resultsSection">
        <div id="results"></div>
      </div>
    </div>
  </section>

  <!-- Chatbot Section -->
  <section class="section section-dark" id="demo">
    <div class="container">
      <h2>Try the AI Threat Hunter</h2>
      <div class="chatbot-container">
        <div class="chat-interface">
          <div class="chat-messages" id="chatMessages">
            <div class="bot-message">
              <div class="message-avatar">ü§ñ</div>
              <div class="message-content">
                <strong>AI Threat Hunter:</strong> Hello! Describe your cyber fraud case, and I‚Äôll analyze it.
              </div>
            </div>
          </div>
          <div class="chat-input-container">
            <textarea id="chatInput" placeholder="Describe your case..." rows="3"></textarea>
            <button id="analyzeBtn" class="analyze-btn">Analyze Case</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>&copy; 2025 AI Threat Hunting Assistant</p>
    </div>
  </footer>

<script>
/* -------- MITRE Search -------- */
const ATTACK_JSON_URL = 'https://raw.githubusercontent.com/mitre/cti/master/enterprise-attack/enterprise-attack.json';
let mitreTechniques = [];

fetch(ATTACK_JSON_URL)
  .then(res => res.json())
  .then(data => {
    mitreTechniques = (data.objects || [])
      .filter(obj => obj.type === 'attack-pattern')
      .map(obj => ({
        id: obj.external_references?.find(ref => ref.source_name === 'mitre-attack')?.external_id || obj.id,
        name: obj.name,
        description: obj.description || ''
      }));
  });

function searchTechniques() {
  const query = document.getElementById("searchInput").value.trim().toLowerCase();
  const resultsDiv = document.getElementById("results");
  const resultsSection = document.getElementById("resultsSection");
  resultsDiv.innerHTML = "";

  if (!query) { resultsSection.style.display = "none"; return; }

  const results = mitreTechniques.filter(t =>
    t.id.toLowerCase().includes(query) ||
    t.name.toLowerCase().includes(query) ||
    t.description.toLowerCase().includes(query)
  );

  if (results.length === 0) {
    resultsDiv.innerHTML = `<p>No techniques found for "<strong>${query}</strong>"</p>`;
  } else {
    resultsDiv.innerHTML = `<h2>Search Results</h2>`;
    results.forEach(t => {
      const div = document.createElement("div");
      div.className = "result-item";
      div.innerHTML = `<strong>${t.id} - ${t.name}</strong><br><small>${t.description}</small>`;
      resultsDiv.appendChild(div);
    });
  }
  resultsSection.style.display = "block";
}

/* -------- Chatbot -------- */
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
document.getElementById("analyzeBtn").addEventListener("click", () => {
  const userText = chatInput.value.trim();
  if (!userText) return;

  // show user message
  const userMsg = document.createElement("div");
  userMsg.className = "user-message";
  userMsg.innerHTML = `<div class="message-avatar">üßë</div><div class="message-content">${userText}</div>`;
  chatMessages.appendChild(userMsg);

  chatInput.value = "";

  // fake bot reply
  setTimeout(() => {
    const botMsg = document.createElement("div");
    botMsg.className = "bot-message";
    botMsg.innerHTML = `
      <div class="message-avatar">ü§ñ</div>
      <div class="message-content">
        <strong>AI Threat Hunter:</strong> Based on your description, potential MITRE techniques might involve phishing (T1566) or credential access (T1078). Further analysis required.
      </div>`;
    chatMessages.appendChild(botMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }, 800);
});
</script>
</body>
</html>
